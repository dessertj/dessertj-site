<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.12">
<title>dessert</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>dessert</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#features">Features</a></li>
<li><a href="#goals">Goals</a></li>
<li><a href="#getting-started">Getting Started</a>
<ul class="sectlevel2">
<li><a href="#minimal-maven-pom">Minimal Maven POM</a></li>
<li><a href="#minimal-gradle-buildfile">Minimal Gradle Buildfile</a></li>
<li><a href="#samples">Samples</a></li>
</ul>
</li>
<li><a href="#basics">Basics</a>
<ul class="sectlevel1">
<li><a href="#classes-and-their-dependencies">Classes and their dependencies</a></li>
<li><a href="#building-blocks">Building Blocks</a></li>
<li><a href="#main-elements-of-the-dessert-api">Main Elements of the Dessert API</a>
<ul class="sectlevel3">
<li><a href="#slice">Slice</a></li>
<li><a href="#sliceentry">SliceEntry</a></li>
<li><a href="#slicecontext">SliceContext</a></li>
<li><a href="#sliceassertions">SliceAssertions</a></li>
</ul>
</li>
<li><a href="#groups-and-cycles">Groups and Cycles</a>
<ul class="sectlevel3">
<li><a href="#slicegroup">SliceGroup</a></li>
<li><a href="#cycle-detection">Cycle detection</a></li>
<li><a href="#enforcing-nesting-rules">Enforcing nesting rules</a></li>
</ul>
</li>
<li><a href="#duplicates">Duplicates</a></li>
</ul>
</li>
<li><a href="#examples">Examples</a>
<ul class="sectlevel1">
<li><a href="#architecture-verification-and-documentation">Architecture verification and documentation</a></li>
<li><a href="#verifying-an-implementation-pattern">Verifying an implementation pattern</a></li>
<li><a href="#detecting-usage-of-internal-classes">Detecting Usage of internal Classes</a></li>
<li><a href="#explorative-analyzation-of-libraries">Explorative Analyzation of Libraries</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The name is a short form of <strong>de</strong>pendency a<strong>ssert</strong>. Hence Dessert is a library to check assertions for
dependencies. It is intended to be used within unit-tests.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="features"><a class="anchor" href="#features"></a>Features</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Checking dependency rules</p>
</li>
<li>
<p>Detection of cyclic dependencies</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="goals"><a class="anchor" href="#goals"></a>Goals</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>No additional dependencies but plain Java 6 or above</p>
</li>
<li>
<p>Simple and intuitive API (motivated by [AssertJ](<a href="https://joel-costigliola.github.io/assertj/)" class="bare">https://joel-costigliola.github.io/assertj/)</a>)</p>
</li>
<li>
<p>Assertions should be robust against refactorings (no strings for class or package names required)</p>
</li>
<li>
<p>Easy and seamless integration with other testing or assertion frameworks</p>
</li>
<li>
<p>Speed</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started"><a class="anchor" href="#getting-started"></a>Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After having included the test dependency <code>com.github.hajo70:dessert:0.3</code> from the
<code>https://jitpack.io</code> repository a test checking all dependencies of the dessert library can
be implemented like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@Test
public void checkDessertDependencies() throws IOException {
    SliceContext sc = new SliceContext();
    Slice dessert = sc.packageTreeOf("de.spricom.dessert")
            .without(sc.packageTreeOf("de.spricom.dessert.test"));
    Slice java = sc.packageTreeOf("java");
    SliceAssertions.assertThat(dessert).usesOnly(java);
}</pre>
</div>
</div>
<div class="sect2">
<h3 id="minimal-maven-pom"><a class="anchor" href="#minimal-maven-pom"></a>Minimal Maven POM</h3>
<div class="paragraph">
<p>A copy of the following Maven POM can be used to get started with dessert:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;groupId&gt;com.company.samples&lt;/groupId&gt;
&lt;artifactId&gt;dessert-sample&lt;/artifactId&gt;
&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.github.hajo70&lt;/groupId&gt;
        &lt;artifactId&gt;dessert&lt;/artifactId&gt;
        &lt;version&gt;0.3&lt;/version&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;junit&lt;/groupId&gt;
        &lt;artifactId&gt;junit&lt;/artifactId&gt;
        &lt;version&gt;4.12&lt;/version&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    &lt;repositories&gt;
        &lt;repository&gt;
            &lt;id&gt;jitpack.io&lt;/id&gt;
            &lt;url&gt;https://jitpack.io&lt;/url&gt;
        &lt;/repository&gt;
    &lt;/repositories&gt;
&lt;/project&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="minimal-gradle-buildfile"><a class="anchor" href="#minimal-gradle-buildfile"></a>Minimal Gradle Buildfile</h3>
<div class="paragraph">
<p>The corresponding Gradle build file looks like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>apply plugin: 'java'</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>repositories {
    jcenter()
    maven { url 'https://jitpack.io' }
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>dependencies {
    testCompile 'com.github.hajo70:dessert:0.3'
    testCompile 'junit:junit:4.12'
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="samples"><a class="anchor" href="#samples"></a>Samples</h3>
<div class="paragraph">
<p>There is a separate [dessert-samples](<a href="https://github.com/hajo70/dessert-samples" class="bare">https://github.com/hajo70/dessert-samples</a>) project
showing how to use dessert with features of Java 8.</p>
</div>
</div>
</div>
</div>
<h1 id="basics" class="sect0"><a class="anchor" href="#basics"></a>Basics</h1>
<div class="sect1">
<h2 id="classes-and-their-dependencies"><a class="anchor" href="#classes-and-their-dependencies"></a>Classes and their dependencies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The goal of dependency checking is finding unwanted dependencies. Dessert does this be analyzing
.class files. The java compiler generates a .class file for each</p>
</div>
<div class="ulist">
<ul>
<li>
<p>class</p>
</li>
<li>
<p>interface</p>
</li>
<li>
<p>annotation</p>
</li>
<li>
<p>(anonymous) innerclass or inner interface</p>
</li>
<li>
<p>enum class</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Note: A java source file can define more than one class.</strong></p>
</div>
<div class="paragraph">
<p>Such a .class file X depends on another .class file Y if X uses Y, thus</p>
</div>
<div class="ulist">
<ul>
<li>
<p>X extends or implements Y</p>
</li>
<li>
<p>X has a field of type Y,</p>
</li>
<li>
<p>X uses Y in a method signature (parameter, return value, throws clause)</p>
</li>
<li>
<p>X has a local variable of Y</p>
</li>
<li>
<p>X uses a (static) method of Y (direct call or method reference)</p>
</li>
<li>
<p>X throws Y</p>
</li>
<li>
<p>X implements Y within a λ-expression</p>
</li>
<li>
<p>X is an inner class of Y (or the other way round)</p>
</li>
<li>
<p>X uses generic type of Y</p>
</li>
<li>
<p>X is annotated with Y</p>
</li>
<li>
<p>X uses Y as an annotation parameter</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Note:</strong>
- Import statements are no relevant, because they don&#8217;t appear in a .class file.
- It&#8217;s not possible to detect all of these uses (i. e. local variables, method references)
  by reflection.
- Jdeps does not consider classes used in annotation parameters as a dependency, but dessert does
  (see [JDK-8134625](<a href="https://bugs.openjdk.java.net/browse/JDK-8134625)" class="bare">https://bugs.openjdk.java.net/browse/JDK-8134625)</a>).
- The compiler my have removed some source dependency that cannot be detected in the .class file
  anymore.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="building-blocks"><a class="anchor" href="#building-blocks"></a>Building Blocks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In a clean software design each class belongs to some building block. Each build block has
defined interfaces and clear dependencies. In complex systems building blocks may be composed
from other building blocks or they may be organized in layers or vertical slices.</p>
</div>
<div class="paragraph">
<p>Ideally there is a clear and intuitive mapping between the physical package structure and the
building blocks of a software:</p>
</div>
<div class="paragraph">
<p>![Structural Architecture](structural-architecture.svg)</p>
</div>
<div class="paragraph">
<p>Dessert helps you to move towards such a clean software design and alarms you immediately
if you are moving backward.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="main-elements-of-the-dessert-api"><a class="anchor" href="#main-elements-of-the-dessert-api"></a>Main Elements of the Dessert API</h2>
<div class="sectionbody">
<div class="sect3">
<h4 id="slice"><a class="anchor" href="#slice"></a>Slice</h4>
<div class="paragraph">
<p>For dessert your software is just a bunch of classes. Hence you have to cut it down to
pieces that make up building blocks. In dessert such a piece is a called a <code>Slice</code>.
A <code>Slice</code> is an arbitrary slice of the set of all classes that belong to a software.
A <code>Slice</code> is immutable. The method <code>slice</code> can be used to create as smaller <code>Slice</code> from
a existing <code>Slice</code>. Two slices can be combined with the methods <code>with</code> (union) and
<code>without</code> (difference) to a new <code>Slice</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sliceentry"><a class="anchor" href="#sliceentry"></a>SliceEntry</h4>
<div class="paragraph">
<p>Each <code>SliceEntry</code> represents a .class file. It has methods like <code>getClassName()</code> or
<code>getClazz()</code> to access the details of the .class to be used for predicates. It&#8217;s most
important method is <code>getUsedClasses()</code> which is used by the <code>SliceAssertions</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="slicecontext"><a class="anchor" href="#slicecontext"></a>SliceContext</h4>
<div class="paragraph">
<p>The <code>SliceContext</code> is the entry point to dessert, a factory for slices. To get your
initial slices you can use the methods <code>packageOf</code>, <code>packageTreeOf</code> or <code>sliceOf</code>.
The <code>SliceContext</code> implements the fly-weight pattern for slice entries. Hence for
two <em>SliceEntry</em> objects x and y that originate from the same <code>SliceContext</code>
x.equals(y) is equivalent to x == y. Of nothing else is specified the <code>SliceContext</code>
operates on the current class-path.</p>
</div>
</div>
<div class="sect3">
<h4 id="sliceassertions"><a class="anchor" href="#sliceassertions"></a>SliceAssertions</h4>
<div class="paragraph">
<p><code>SliceAssertions</code> is a utility class that provides a fluent API with static methods
analogous to [AssertJ](<a href="https://joel-costigliola.github.io/assertj/" class="bare">https://joel-costigliola.github.io/assertj/</a>). It&#8217;s most important
method is <code>assertThat</code> or it&#8217;s synonym <code>dessert</code>, so that it can be used with static
imports without conflicting with AssertJ. The most important methods of the fluent API
are <code>doesNotUse</code>, <code>usesOnly</code> or the combination of <code>uses</code>, <code>and</code> and <code>only()</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="groups-and-cycles"><a class="anchor" href="#groups-and-cycles"></a>Groups and Cycles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The problem with a dependency cycle is: there is no starting point. Thus, you cannot use
or test a class involved in a cycle without having all other classes available. (By using
a mocking framework limited testing of an isolated class is possible.) Small
cycles between classes are often necessary, but big intertwined cycles make your software
a ball of wool. In such an environment testing is a nightmare because each simple test
needs a very complex setup that initializes all parts of the software. It is not possible
to re-use such a software without replicating the whole infrastructure with all its system
requirements, even if only a small part is required.</p>
</div>
<div class="sect3">
<h4 id="slicegroup"><a class="anchor" href="#slicegroup"></a>SliceGroup</h4>
<div class="paragraph">
<p>For cycle detection dessert provides the concept of a <code>SliceGroup</code>. As the name says, a
<code>SliceGroup</code> is a group of <code>Slice</code> objects. The <code>SliceGroup</code> has the static convenience
factory methods <code>splitByPackage</code> and <code>splitByEntry</code> to split up a <code>Slice</code> into smaller
corresponding slices. By providing a <code>SlicePartioner</code> an arbitrary criterium can be used
to split up a <code>Slice</code>. All <code>SliceEntry</code> objects the <code>partKey</code> method maps to the same
string will be in the same <code>Slice</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="cycle-detection"><a class="anchor" href="#cycle-detection"></a>Cycle detection</h4>
<div class="paragraph">
<p>To detect cycles for a <code>SliceGroup</code> <strong>sg</strong> you can use:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SliceGroup&lt;PackageSlice&gt; sg = SliceGroup.splitByPackage(slice);
SliceAssertions.dessert(sg).isCycleFree();</pre>
</div>
</div>
<div class="paragraph">
<p>This can be shortend to:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SliceAssertions.dessert(slice).splitByPackage().isCycleFree();</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="enforcing-nesting-rules"><a class="anchor" href="#enforcing-nesting-rules"></a>Enforcing nesting rules</h4>
<div class="paragraph">
<p>One method to prevent package cycles is establishing dependency rules for nested packages. For
example dessert follows the rule a deeper nested package must not use a class from it&#8217;s parent
package. <code>SliceGroup</code> implements the <code>Iterator</code> interface, hence the following code can be used
to enforce this rule:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Slice slice = new SliceContext().packageTreeOf("de.spricom.dessert");
SliceGroup&lt;PackageSlice&gt; packages = SliceGroup.splitByPackage(slice);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>packages.forEach(pckg -&gt; SliceAssertions.assertThat(pckg)
        .doesNotUse(pckg.getParentPackage(packages)));</pre>
</div>
</div>
<div class="paragraph">
<p>The code above disallows only dependencies to direct parent packages. To disallow dependencies
to any ancestor package one could write:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Slice slice = new SliceContext().packageTreeOf("de.spricom.dessert");
SliceGroup&lt;PackageSlice&gt; packages = SliceGroup.splitByPackage(slice);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>packages.forEach(pckg -&gt; SliceAssertions.assertThat(pckg)
        .doesNotUse(slice.slice(entry -&gt; pckg.getParentPackageName().startsWith(entry.getPackageName()))));</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="duplicates"><a class="anchor" href="#duplicates"></a>Duplicates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A common source of errors are duplicate .class files on the class-path. To load a class only it&#8217;s fully qualified
name is required. Therefore, the ClassLoader scans the entries on the class-path for the first .class file with
that name. Thus, the order on the class-path matters. The same .class file may appear in different libraries and
the one loaded by the ClassLoader may not be the one you want.</p>
</div>
<div class="paragraph">
<p>For dessert two <code>SliceEntry</code> objects are only equal if they point to the same .class file, thus their <code>getURI</code>
method returns the same value. The ``getAlternatives()`` method returns all <code>SliceEntry</code> objects found by dessert
that have the same fully qualified classname. Ideally there is only one alternative - the <code>SliceEntry</code> itself.</p>
</div>
<div class="paragraph">
<p>By default the <code>SliceContext</code> scans the whole class-path and finds all duplicates (to be precise it scans all
jar&#8217;s and class-directories visible to its <code>Resolver</code>). The <code>duplicates</code> method returns a <code>Slice</code> containing
all duplicates. Hence the following code can be used to ensure there are none:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ConcreteSlice duplicates = new SliceContext().duplicates();
StringBuilder sb = new StringBuilder();
duplicates.getSliceEntries().forEach(entry -&gt; sb.append(entry.getURI()).append("\n"));
assertThat(duplicates.getSliceEntries()).as(sb.toString()).isEmpty();</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note: The <code>SliceEntry</code> method <code>getClazz()</code> uses the system classloader to load a class with the corresponding
name. Hence it always returns the same implementation and not necessarily the one that corresponds the
<code>SliceEntry</code>'s .class file. This will be fixed in a future version.</strong></p>
</div>
<div class="paragraph">
<p><strong>Note: When dependency checking considers always all <code>SliceEntry</code> objects that belong to the <code>Slice</code> even if
some are duplicates.</strong></p>
</div>
</div>
</div>
<h1 id="examples" class="sect0"><a class="anchor" href="#examples"></a>Examples</h1>
<div class="paragraph">
<p>Besides the samples given for [cycle detection](#cycle-detection) and finding [duplicates](#duplicates) here
are some typical samples of using dessert.</p>
</div>
<div class="sect1">
<h2 id="architecture-verification-and-documentation"><a class="anchor" href="#architecture-verification-and-documentation"></a>Architecture verification and documentation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each architecture verification requires two steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Defining the building blocks</p>
</li>
<li>
<p>Checking dependencies between these building blocks</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example the [spring batch architecture](<a href="https://docs.spring.io/spring-batch/trunk/reference/html/spring-batch-intro.html#springBatchArchitecture" class="bare">https://docs.spring.io/spring-batch/trunk/reference/html/spring-batch-intro.html#springBatchArchitecture</a>)
could be verified like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SliceContext sc = new SliceContext();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// defining the building blocks of spring-batch
Slice springBatchCore = sc.packageTreeOf("org.springframework.batch.core");
Slice springBatchTest = sc.packageTreeOf("org.springframework.batch.test");
Slice springBatchInfrastructure =
        sc.packageTreeOf("org.springframework.batch")
                .without(springBatchCore)
                .without(springBatchTest);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// checking for disallowed dependencies
SliceAssertions.assertThat(springBatchInfrastructure).doesNotUse(springBatchCore);</pre>
</div>
</div>
<div class="paragraph">
<p>The package name can be replaced by a class located in the package. This makes the code more robust
against refactorings, but harder to read:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Slice springBatchCore = sc.packageTreeOf(Job.class);
Slice springBatchTest = sc.packageTreeOf(StepRunner.class);</pre>
</div>
</div>
<div class="paragraph">
<p>The methods <code>doesNotUse</code> and <code>usesOnly</code> accept any number of building blocks:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SliceAssertions.assertThat(springBatchInfrastructure).doesNotUse(springBatchCore, springBatchTest);</pre>
</div>
</div>
<div class="paragraph">
<p>For <code>usesOnly</code> there is a fluent alternative for a long list of dependencies:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SliceContext sc = new SliceContext();
Slice springBatchCore = sc.packageTreeOf(Job.class);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// make sure a building block does not introduce unintended dependencies
SliceAssertions.assertThat(springBatchCore)
        .uses(sc.packageTreeOf("org.springframework"))
        .and(sc.packageTreeOf("java"))
        .and(sc.packageTreeOf("org.apache.commons.logging"))
        .and(sc.packageTreeOf("org.aspectj.lang.annotation"))
        .and(sc.packageTreeOf("org.aopalliance"))
        .and(sc.packageTreeOf("com.thoughtworks.xstream"))
        .and(sc.packageTreeOf("com.fasterxml.jackson"))
        .and(sc.packageTreeOf("org.w3c.dom"))
        .only();</pre>
</div>
</div>
<div class="paragraph">
<p>Such a test not only verifies the architecture but it also documents it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="verifying-an-implementation-pattern"><a class="anchor" href="#verifying-an-implementation-pattern"></a>Verifying an implementation pattern</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The motivation of the [MVP pattern in GWT applications](<a href="http://www.gwtproject.org/articles/mvp-architecture.html" class="bare">http://www.gwtproject.org/articles/mvp-architecture.html</a>)
was to separate view code that requires a JavaScript environment from view logic that is executable in a pure
Java environment and can be tested by simple unit-tests. Therefore, the presenter must use the view implementation
only through an interface. This can be checked like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Slice presenters = mvp.slice(se -&gt; se.getClassName().endsWith("Presenter"));
Slice views = mvp.slice(se -&gt; se.getClassName().endsWith("ViewImpl"));
assertThat(presenters).doesNotUse(views);</pre>
</div>
</div>
<div class="paragraph">
<p>The sample above assumes a naming conventions for presenters and view implementations. Alternatively presenters
and view implementations can be recognized by an interface they implement or a superclass they extend:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Slice presenters = mvp.slice(se -&gt; Presenter.class.isAssignableFrom(se.getClazz()));
Slice views = mvp.slice(se -&gt; ViewBase.class.isAssignableFrom(se.getClazz()));</pre>
</div>
</div>
<div class="paragraph">
<p>This sample shows that a <code>Slice</code> can be an arbitrary set of classes, it&#8217;s not tied to a building block.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="detecting-usage-of-internal-classes"><a class="anchor" href="#detecting-usage-of-internal-classes"></a>Detecting Usage of internal Classes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Every library has a public API and some internal classes required by the library itself to accomplish
its task. These internal classes should not be used by other applications, because they are subject to
change without notice. Before Java 9 there was no way to make sure no internal classes are used. Dessert
can detect such usages even in older versions of Java. For example, if you want to migrate your software
to Java 9 you should make sure no internal JDK classes are used. This can be done like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SliceContext sc = new SliceContext();
Slice dessert = sc.packageTreeOf("de.spricom.dessert");</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>assertThat(dessert).doesNotUse(
        sc.packageTreeOf("com.sun"),
        sc.packageTreeOf("sun"));</pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s better practice to explicitly specify the allowed packages than to specify what is not allowed:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>assertThat(dessert).usesOnly(sc.packageTreeOf("java"));</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="explorative-analyzation-of-libraries"><a class="anchor" href="#explorative-analyzation-of-libraries"></a>Explorative Analyzation of Libraries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Typically each library comes with a bunch of dependencies. Even worse, some frameworks (i. e. Spring Boot)
initialize and start services if some library appears on the class-path. Let&#8217;s say you want to convert
an CSV file to XML. Therefore, you want to use the corresponding item-reader and -writer of Spring Batch
without all the overhead of the framework. To find out what dependencies you need for that case you could
use the following code:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SliceContext sc = new SliceContext();
Slice batchItemInfra = sc.packageTreeOf("org.springframework.batch.item.file")
        .with(sc.packageTreeOf("org.springframework.batch.item.xml"));</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>dessert(batchItemInfra).uses(sc.packageTreeOf("java")).only();</pre>
</div>
</div>
<div class="paragraph">
<p>The resulting failure lists all dependencies besides the Java runtime classes.</p>
</div>
<div class="paragraph">
<p>(small modifcation)</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-01-30 23:48:45 UTC
</div>
</div>
</body>
</html>