<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.12">
<title>Dessert Dependency Assertion Library for Java</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Dessert Dependency Assertion Library for Java</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#getting_started">1. Getting Started</a>
<ul class="sectlevel2">
<li><a href="#maven-dependency">1.1. Maven Dependency</a></li>
<li><a href="#snapshot-dependency-optional-alternative">1.2. Snapshot Dependency (optional alternative)</a></li>
<li><a href="#first-test">1.3. First Test</a></li>
<li><a href="#first-modules-test">1.4. First Modules Test</a></li>
</ul>
</li>
<li><a href="#introduction">2. Introduction</a></li>
<li><a href="#concepts-and-terminology">3. Concepts and Terminology</a>
<ul class="sectlevel2">
<li><a href="#slices">3.1. Slices</a></li>
<li><a href="#modules">3.2. Modules</a></li>
<li><a href="#name-patterns">3.3. Name-Patterns</a></li>
<li><a href="#predicates">3.4. Predicates</a></li>
<li><a href="#assertions">3.5. Assertions</a></li>
<li><a href="#cycle-detection">3.6. Cycle detection</a></li>
<li><a href="#architecture-verification">3.7. Architecture verification</a></li>
<li><a href="#class-resolving">3.8. Class resolving</a></li>
<li><a href="#duplicates">3.9. Duplicates</a></li>
</ul>
</li>
<li><a href="#practical-guide">4. Practical Guide</a>
<ul class="sectlevel2">
<li><a href="#motivation">4.1. Motivation</a></li>
<li><a href="#sample-code">4.2. Sample Code</a></li>
<li><a href="#detecting-unwanted-dependencies">4.3. Detecting unwanted dependencies</a></li>
<li><a href="#enforcing-architecture-requirements">4.4. Enforcing architecture requirements</a></li>
<li><a href="#utilize-jpms-information">4.5. Utilize JPMS information</a></li>
<li><a href="#more-details-about-defining-slices">4.6. More details about defining slices</a></li>
<li><a href="#detecting-cycles">4.7. Detecting cycles</a></li>
<li><a href="#keeping-vertical-slices-apart">4.8. Keeping vertical slices apart</a></li>
<li><a href="#checking-a-layered-architecture">4.9. Checking a layered architecture</a></li>
<li><a href="#detecting-duplicates">4.10. Detecting duplicates</a></li>
<li><a href="#simulating-refactorings">4.11. Simulating refactorings</a></li>
<li><a href="#defining-a-custom-classpath">4.12. Defining a custom classpath</a></li>
</ul>
</li>
<li><a href="#design-goals-and-features">5. Design Goals and Features</a></li>
<li><a href="#getting-involved">6. Getting Involved</a></li>
<li><a href="#frequently-asked-questsions">7. Frequently asked Questsions</a>
<ul class="sectlevel2">
<li><a href="#when-will-be-there-a-1-0-version">7.1. When will be there a 1.0 version?</a></li>
<li><a href="#why-does-dessert-find-more-dependencies-than-jdeps">7.2. Why does dessert find more dependencies than <em>jdeps</em>?</a></li>
</ul>
</li>
<li><a href="#plans-for-dessert-core-0-6-x">8. Plans for dessert-core 0.6.x</a></li>
<li><a href="#release-notes">9. Release Notes</a>
<ul class="sectlevel2">
<li><a href="#dessert-core-0-5-6">9.1. dessert-core-0.5.6</a></li>
<li><a href="#dessert-core-0-5-5">9.2. dessert-core-0.5.5</a></li>
<li><a href="#dessert-core-0-5-4">9.3. dessert-core-0.5.4</a></li>
<li><a href="#dessert-core-0-5-3">9.4. dessert-core-0.5.3</a></li>
<li><a href="#dessert-core-0-5-2">9.5. dessert-core-0.5.2</a></li>
<li><a href="#dessert-core-0-5-1">9.6. dessert-core-0.5.1</a></li>
<li><a href="#dessert-core-0-5-0">9.7. dessert-core-0.5.0</a></li>
<li><a href="#dessert-core-0-4-3">9.8. dessert-core-0.4.3</a></li>
<li><a href="#dessert-core-0-4-2">9.9. dessert-core-0.4.2</a></li>
<li><a href="#dessert-core-0-4-1">9.10. dessert-core-0.4.1</a></li>
<li><a href="#dessert-core-0-4-0">9.11. dessert-core-0.4.0</a></li>
<li><a href="#older-releases">9.12. Older Releases</a></li>
</ul>
</li>
<li><a href="#copyright-and-license">10. Copyright and License</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>A library for unit-tests to check dependencies between classes.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Resources on GitHub</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Repository</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/dessertj/dessertj-core">dessertj-core</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Library source code</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/dessertj/dessertj-site">dessertj-site</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Documentation source code</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/dessertj/dessertj-tests">dessertj-tests</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tests and samples</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Documentation</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Release</th>
<th class="tableblock halign-left valign-top">Reference Doc.</th>
<th class="tableblock halign-left valign-top">API Doc.</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/dessertj/dessertj-core">0.6.0-SNAPSHOT</a></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://dessertj.github.io/dessert-site/index.html">reference</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://dessertj.github.io/dessert-core/index.html">javadoc</a></p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/hajo70/dessert-core/releases/tag/dessert-core-0.5.6">0.5.6</a></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://dessertj.org/index.html">reference</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://dessertj.org/apidocs/index.html">javadoc</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="getting_started"><a class="anchor" href="#getting_started"></a>1. Getting Started</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="maven-dependency"><a class="anchor" href="#maven-dependency"></a>1.1. Maven Dependency</h3>
<div class="paragraph">
<p>Add the <em>dessert-core</em> dependency to your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.dessertj&lt;/groupId&gt;
    &lt;artifactId&gt;dessert-core&lt;/artifactId&gt;
    &lt;version&gt;0.5.6&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="snapshot-dependency-optional-alternative"><a class="anchor" href="#snapshot-dependency-optional-alternative"></a>1.2. Snapshot Dependency (optional alternative)</h3>
<div class="paragraph">
<p>To try out the most current snapshot use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;de.spricom.dessert&lt;/groupId&gt;
    &lt;artifactId&gt;dessert-core&lt;/artifactId&gt;
    &lt;version&gt;0.5.7-SNAPSHOT&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Snapshot releases require the <em>OSSRH Snapshot Repository</em>&gt;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;repositories&gt;
    &lt;repository&gt;
        &lt;id&gt;ossrh&lt;/id&gt;
        &lt;name&gt;OSSRH Snapshot Repository&lt;/name&gt;
        &lt;url&gt;https://oss.sonatype.org/content/repositories/snapshots&lt;/url&gt;
        &lt;snapshots&gt;
            &lt;enabled&gt;true&lt;/enabled&gt;
        &lt;/snapshots&gt;
    &lt;/repository&gt;
&lt;/repositories&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="first-test"><a class="anchor" href="#first-test"></a>1.3. First Test</h3>
<div class="paragraph">
<p>Implement your first dependency test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Test
void willFail() {
    Classpath cp = new Classpath();
    Clazz me = cp.asClazz(this.getClass());
    Root junit = cp.rootOf(Test.class);
    SliceAssertions.assertThatSlice(me).doesNotUse(junit);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each <em>dessert</em> test starts with the <code>Classpath</code>. <code>Classpath</code>, <code>Clazz</code> and <code>Root</code> all implement
the <code>Slice</code> interface. Imagine the <code>Classpath</code> to be a cake that has to be sliced down to
suitable pieces. The <code>Clazz</code> is the smallest possible piece, it represents a single .class file.
A <code>Root</code> is a classes directory, a .jar file or a JDK module. <code>SliceAssertion</code> provides a
static <code>assertThatSlice</code> method to check for unwanted dependencies between slices.</p>
</div>
<div class="paragraph">
<p>The test above will fail, because it has a dependency to the junit-jupiter-api.jar. Thus, it
produces the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>java.lang.AssertionError: Illegal Dependencies:
de.spricom.dessert.start.DessertSampleTest
 -&gt; org.junit.jupiter.api.Test</pre>
</div>
</div>
<div class="paragraph">
<p>The following test shows some other methods to get slices from the <code>Classpath</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Test
void willSucceed() {
    Classpath cp = new Classpath();
    Slice myPackage = cp.packageOf(this.getClass());
    Slice java = cp.slice("java..*");
    Slice libs = cp.packageOf(Test.class).plus(cp.slice("..dessert.assertions|slicing.*"));
    assertThatSlice(myPackage).usesOnly(java, libs);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>java..*</em> slice represents all classes in the <code>java</code> package or any nested package.
The methods <code>plus</code> and <code>minus</code> can be used do create new slices from existing slices.
The most important methods for slice assertions are <code>doesNotUse</code> and <code>usesOnly</code>.
Both accept more than one slice.</p>
</div>
<div class="paragraph">
<p>To find out more read the <a href="#practical-guide">Practical Guide</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="first-modules-test"><a class="anchor" href="#first-modules-test"></a>1.4. First Modules Test</h3>
<div class="paragraph">
<p>With dessert projects can profit form the Java Platform Module System (JPMS), even
if they don&#8217;t use modules. Therefore, dessert provides an easy and intuitive module API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package de.spricom.dessert.intro;

import de.spricom.dessert.assertions.SliceAssertions;
import de.spricom.dessert.modules.ModuleRegistry;
import de.spricom.dessert.modules.core.ModuleSlice;
import de.spricom.dessert.modules.fixed.JavaModules;
import de.spricom.dessert.slicing.Classpath;
import de.spricom.dessert.slicing.Slice;
import org.junit.jupiter.api.Test;

import static de.spricom.dessert.assertions.SliceAssertions.assertThatSlice;

class ModulesSampleTest {
    private final Classpath cp = new Classpath();
    private final ModuleRegistry mr = new ModuleRegistry(cp);
    private final JavaModules java = new JavaModules(mr);
    private final ModuleSlice junit = mr.getModule("org.junit.jupiter.api");
    private final Slice dessert = cp.rootOf(SliceAssertions.class);

    @Test
    void testDessertDependencies() {
        assertThatSlice(dessert)
                .usesOnly(java.base, java.logging);
    }

    @Test
    void testMyDependencies() {
        assertThatSlice(cp.sliceOf(this.getClass()))
                .usesOnly(java.base, junit, dessert);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Through the <code>ModuleRegistry</code> modules can be accessed by name. <code>JavaModules</code> provides
constants for all <em>java</em> modules as of JDK 17. Both are available even for JDK 8 and
earlier. The <code>usesOnly</code> assertion makes sure only exported packages
are used from the modules listed.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>2. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The name <strong>dessert</strong> comes from <strong>de</strong>pendency a<strong>ssert</strong>.
Hence, <strong>dessert</strong> is a library for unit-tests to check dependencies between classes.
It&#8217;s used to keep an architecture clean.</p>
</div>
<div class="paragraph">
<p>Simply said an architecture is something you can express with
a <a href="https://en.wikipedia.org/wiki/Block_diagram">block diagram</a>,
that is a diagram with blocks and arrows between them.
A block is an arbitrary part of a software-system. The arrows show the
dependencies between the blocks.</p>
</div>
<div class="paragraph">
<p>Dessert provides an API to write down such block diagrams in Java code:
The <code>Slice</code> interface represents a block. Dessert has many ways
to specify what belongs to such a block.
Dessert&#8217;s assertion API expresses the dependencies between the block.</p>
</div>
<div class="paragraph">
<p>Can you see the advantage? If you use this API to describe your
architecture within a unit-test, it will ensure reality matches
the design each time the test is run.</p>
</div>
<div class="paragraph">
<p>When you describe architecture requirements as unit-tests each
violation will turn on a red traffic-light on your CI-pipeline.
Thus, they will be fixed immediately, and they will get much more
attention within your team. Over time this improves the quality of
your architecture.</p>
</div>
<div class="paragraph">
<p>An architecture describes a complex system by breaking it apart
into smaller pieces. Then it specifies the relations to or
interactions with the other pieces of the system.
In an implementation of the system the relations
or interactions show up as dependencies. Hence, checking
architecture requirements can be reduced to dependency checking.</p>
</div>
<div class="paragraph">
<p>The goal of dependency checking is finding unwanted dependencies.
Dessert does this be analyzing .class files.
The java compiler generates a .class file for each
class, interface, annotation, record or enum and their inner variants.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A java source file can define more than one class.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In <em>dessert</em>  a .class file is represented by <code>Clazz</code>.
The <code>Clazz</code> is the smallest unit of granularity <em>dessert</em> can work with. The biggest
unit is the <code>Classpath</code>. The <code>Classpath</code> contains all classes available for an application,
these are the classes of the application code, all classes of its dependencies and
all JDK classes.</p>
</div>
<div class="paragraph">
<p>A <em>dessert</em> based test checks dependency assertions. Each dependency assertion requires
three parts:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The application code the assertion is about.</p>
</li>
<li>
<p>The dependencies the assertion is about.</p>
</li>
<li>
<p>The requirement that has to be fulfilled.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Both the application code and the dependencies are a slice of classes taken from the class-path.
Therefore, the <code>Classpath</code> has different methods to get a <code>Slice</code> from it.
Just imagine the <code>Classpath</code> to be big cake you have to slice down.
Thus the most import concept of <em>dessert</em> is the <code>Slice</code>.</p>
</div>
<div class="paragraph">
<p>Architecture requirements are expressed with a fluent API starting with the static
<code>SliceAssertions</code> method <code>assertThatSlice</code>. The application code to
check is the parameter of this method. Next comes the requirement, which
is one of the methods <code>doesNotUse</code> or <code>usesOnly</code>. The parameter(s) of
these methods are the dependencies the assertion is about.</p>
</div>
<div class="paragraph">
<p>Hence, a complete <em>dessert</em> test looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package de.spricom.dessert.intro;

import de.spricom.dessert.slicing.Classpath;
import de.spricom.dessert.slicing.Root;
import de.spricom.dessert.slicing.Slice;
import org.junit.jupiter.api.Test;

import static de.spricom.dessert.assertions.SliceAssertions.assertThatSlice;

class SlicingSampleTest {
    private static final Classpath cp = new Classpath();

    @Test
    void checkDessertLibraryDependencies() {
        // application code:
        Root dessert = cp.rootOf(Slice.class);

        // dependencies:
        Slice allowedDependencies = cp.slice("java.lang|util|io|net..*");

        // requirement:
        assertThatSlice(dessert).usesOnly(allowedDependencies);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="concepts-and-terminology"><a class="anchor" href="#concepts-and-terminology"></a>3. Concepts and Terminology</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="slices"><a class="anchor" href="#slices"></a>3.1. Slices</h3>
<div class="paragraph">
<p>When using dessert you work most of the time with some <code>Slice</code> implementation.
Mostly this is one of:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Slice</dt>
<dd>
<p>Dessert is all about slices. A slice is an arbitrary set of .class files.</p>
</dd>
<dt class="hdlist1">Clazz</dt>
<dd>
<p>The <code>Clazz</code> is the smallest possible slice. It represents a single .class file.</p>
</dd>
<dt class="hdlist1">Classpath</dt>
<dd>
<p>The <code>Classpath</code> is the starting point of every <em>dessert</em> test and the biggest
possible slice.
<strong>Warning: Never try to combine slices from different Classpath instances!</strong></p>
</dd>
<dt class="hdlist1">Root</dt>
<dd>
<p>A <code>Root</code> is a special slice that represents a .jar file or a classes directory.</p>
</dd>
<dt class="hdlist1">ModuleSlice</dt>
<dd>
<p>A <code>ModuleSlice</code> represents the public interface of a module.
For a JPMS module these are all unqualified exports.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following diagram gives an overview of the implementations provided by dessert:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/slice-overview.svg" alt="slice overview" width="750" height="331">
</div>
</div>
<div class="paragraph">
<p>The most important <code>Slice</code> methods are <code>plus</code>, <code>minus</code>, and <code>slice</code> to create new slices from existing
ones. The <code>AbstractRootSlice</code> provides some convenience methods to work with packages. <code>packageOf</code> returns
a slice of all classes within one package (without sub-packages). <code>packageTreeOf' returns a slice of
all classes within a package, or a nested sub-package. Called on a `Root</code> these methods return only
classes within that root. A <code>Root</code> is a classes directory or a .jar file that belongs to the <code>Classpath</code>.
To get a <code>Root</code> you can use the <code>Classpath</code> method <code>rootOf</code>.</p>
</div>
<div class="paragraph">
<p>The <code>Classpath</code> methods <code>asClazz</code> and <code>sliceOf</code> can create slices for classes that are not on the
<code>Classpath</code> such as classes located in the java or javax packages or dependencies of some classes.
In such a case the <code>Classpath</code> uses the current <code>ClassLoader</code> to get the corresponding .class file.
If this does not work either, it creates a placeholder <code>Clazz</code> that contains only the classname.</p>
</div>
<div class="paragraph">
<p>The <code>slice</code> methods of <code>Classpath</code> do not necessarily return a slice that can be resolved to a concrete
set of classes. A slice may also be defined by a name-pattern or some predicate. For such a slice one
can use the <code>contains</code> method to check whether a <code>Clazz</code> belongs to it, thus the class fulfills
all predicates. But calling <code>getClazzes</code> will throw a <code>ResolveException</code>. This happens if the
<code>Classpath</code> contains none of the classes belonging to the slice. Internally <em>dessert</em> works with such
predicate based slices as long as <code>getClazzes</code> has not been called, for performance reasons.</p>
</div>
<div class="paragraph">
<p><em>Dessert</em> has been optimized to resolve name-pattern very fast. Hence, it&#8217;s a good practice to first
slice be name (or <code>packageOf</code>/<code>packageTreeOf</code>) then used predicates to slice-down the slices further.</p>
</div>
<div class="paragraph">
<p><code>getDependencies</code> returns the dependencies of a slice and <code>uses</code> checks whether some other slice
contains one of these dependencies.</p>
</div>
<div class="paragraph">
<p>To add features to existing slices always extend <code>AbstractDelegateSlice</code>. The <code>named</code> method returns
one such extension that makes a slices' <code>toString</code> method return the name passed.</p>
</div>
</div>
<div class="sect2">
<h3 id="modules"><a class="anchor" href="#modules"></a>3.2. Modules</h3>
<div class="paragraph">
<p>Dessert&#8217;s JPMS support can be used through the <code>ModuleRegistry</code>.
It&#8217;s <code>getModule</code> method returns the corresponding module by name.
<code>JavaModules</code> and <code>JdkModules</code> provides pre-defined constants
for the corresponding JDK 17 modules:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">private final Classpath cp = new Classpath();
private final ModuleRegistry mr = new ModuleRegistry(cp);
private final JavaModules java = new JavaModules(mr);
private final JdkModules jdk = new JdkModules(mr);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following sample is not very useful, but it shows how to use the module API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ModuleSlice junit = mr.getModule("org.junit.jupiter.api");
assertThatSlice(junit.getImplementation()
        .minus(cp.slice("org.junit.jupiter.api.AssertionsKt*")))
        .usesOnly(
                java.base,
                ((JpmsModule)mr.getModule("org.junit.platform.commons"))
                        .getExportsTo("org.junit.jupiter.api"),
                mr.getModule("org.opentest4j"),
                mr.getModule("org.apiguardian.api")
        );</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>ModuleSlice</code> itself contains only the classes exported to anyone.
The <code>getImplementation</code> method of a <code>ModuleSlice</code> returns all classes of a module, no matter whether
they are exported. The <code>JpmsModule</code> method <code>getExportsTo</code> returns the classes that are exported
to some certain module.</p>
</div>
<div class="paragraph">
<p>The module API is fully supported for JDK 8 and earlier. Therefore, dessert comes <code>FixedModule</code>
definitions which are based on JDK 17. They are used as fall-back if the current JDK does not
provide modules.</p>
</div>
<div class="paragraph">
<p><em>AssertionsKt</em> has been excluded, because it adds dependencies to the Kotlin runtime system,
which are not available for Java.</p>
</div>
</div>
<div class="sect2">
<h3 id="name-patterns"><a class="anchor" href="#name-patterns"></a>3.3. Name-Patterns</h3>
<div class="paragraph">
<p>Name-patterns are the most important means to define slices. A name-pattern
identifies a set of classes by their full qualified classname.</p>
</div>
<div class="paragraph">
<p>The syntax has been motivated by the
<a href="https://www.eclipse.org/aspectj/doc/released/progguide/quick-typePatterns.htmlAspectJ" class="bare">https://www.eclipse.org/aspectj/doc/released/progguide/quick-typePatterns.htmlAspectJ</a> TypeNamePattern]
with slight modifications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The pattern can either be a plain type name, the wildcard *, or an
identifier with embedded * or .. wildcards or the | separator.</p>
</li>
<li>
<p>An * matches any sequence of characters, but does not match the package separator ".".</p>
</li>
<li>
<p>An | separates alternatives that do not contain a package separator ".".</p>
</li>
<li>
<p>An .. matches any sequence of characters that starts and ends with the package separator ".".</p>
</li>
<li>
<p>The identifier to match with is always the name returned by {@link Class#getName()}.
Thus, $ is the only inner-type separator supported.</p>
</li>
<li>
<p>The * does match $, too.</p>
</li>
<li>
<p>A leading .. additionally matches the root package.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Examples:</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pattern</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sample.Foo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matches only sample.Foo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sample.Foo*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matches all types in sample starting with "Foo" and all inner-types of Foo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sample.bar|baz.*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matches all types in sample.bar and sample.baz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sample.Foo$*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matches only inner-types of Foo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">..Foo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matches all Foo in any package (incl. root package)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>.</strong>..Foo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matches all Foo nested in a sub-package</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matches all types in the root package</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">..*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matches all types</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="predicates"><a class="anchor" href="#predicates"></a>3.4. Predicates</h3>
<div class="paragraph">
<p>Predicates are another way to define slices. Typically, they are used to selecting classes
from an existing <code>Slice</code> that meets certain properties. <code>Predicate</code> is a functional interface.
<code>Predicates</code> provides <code>and</code>, <code>or</code> and <code>not</code> to combine predicates. <code>ClazzPredicates</code> contains
some pre-defined predicates for classes.</p>
</div>
<div class="paragraph">
<p>The following code fragment demonstrates their usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Classpath cp = new Classpath();
Root dessert = cp.rootOf(Slice.class);
Slice assertions = dessert.packageOf(SliceAssertions.class);
Slice slicing = dessert.packageOf(Slice.class);
Slice slicingInterfaces = slicing.slice(
        Predicates.and(ClazzPredicates.PUBLIC,
                Predicates.or(
                        ClazzPredicates.INTERFACE,
                        ClazzPredicates.ANNOTATION,
                        ClazzPredicates.ENUM
                )
        )
);
SliceAssertions.dessert(assertions).usesNot(slicing.minus(slicingInterfaces));</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>slicingInterfaces</code> contains all public interfaces, enums or annotations of the <code>slicing</code> package within the
<code>dessert-core</code> library. The assertion checks that the <code>assertions</code> packages uses only these types by asserting
that it uses nothing from the complement. That check will fail, because <code>assertions</code> uses i.e. <code>Clazz</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="assertions"><a class="anchor" href="#assertions"></a>3.5. Assertions</h3>
<div class="paragraph">
<p>All dessert assertions start with one of the static <code>SliceAssertions</code> methods <code>assertThat</code>
or its alias <code>dessert</code>. These methods return a <code>SliceAssert</code> object with its most important
methods <code>usesNot</code> and <code>usesOnly</code>. Both methods return a <code>SliceAssert</code> again, so that assertions
can be queued:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Classpath cp = new Classpath();
assertThatSlice(cp.asClazz(this.getClass()))
        .usesNot(cp.slice("java.io|net..*"))
        .usesNot(cp.slice("org.junit.jupiter.api.Assertions"))
        .usesOnly(cp.slice("..junit.jupiter.api.*"),
                cp.slice("..dessert..*"),
                cp.slice("java.lang..*"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>When an assertion fails it throws an <code>AssertionError</code>. The message shows details about the cause
of the failure. This message is produced by the <code>DefaultIllegalDependenciesRenderer</code>. That renderer
can be replaced with the <code>SliceAssert</code> method <code>renderWith</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To have any effect <code>renderWith</code> must be invoked before the assertions (i.e. <code>usesNot</code>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cycle-detection"><a class="anchor" href="#cycle-detection"></a>3.6. Cycle detection</h3>
<div class="paragraph">
<p><code>SliceAssert</code> provides the method <code>isCycleFree</code> to check whether a set of slices has any
cyclic dependencies. Because each <code>Clazz</code> is a <code>Slice</code> one check the classes of slice
for a cycle like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Classpath cp = new Classpath();
dessert(cp.packageTreeOf(CycleDump.class).getClazzes()).isCycleFree();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample contains a cycle, hence it produces the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>java.lang.AssertionError: Cycle detected:
de.spricom.dessert.concepts.cycle.bar.Bar -&gt; de.spricom.dessert.concepts.cycle.CycleDump
de.spricom.dessert.concepts.cycle.CycleDump -&gt; de.spricom.dessert.concepts.cycle.foo.Foo
de.spricom.dessert.concepts.cycle.foo.Foo -&gt; de.spricom.dessert.concepts.cycle.bar.Bar</pre>
</div>
</div>
<div class="paragraph">
<p>Class-cycles are quite common and should not be a problem as long as the cycle is within a
package. Package-cycles on the other hand are an indicator for serious architecture problems.
To detect these you can use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Classpath cp = new Classpath();
Slice slice = cp.packageTreeOf(CycleDump.class);
dessert(slice.partitionByPackage()).isCycleFree();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This produces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>java.lang.AssertionError: Cycle detected:
de.spricom.dessert.concepts.cycle.foo -&gt; de.spricom.dessert.concepts.cycle.bar:
	Foo -&gt; Bar
de.spricom.dessert.concepts.cycle.bar -&gt; de.spricom.dessert.concepts.cycle:
	Bar -&gt; CycleDump
de.spricom.dessert.concepts.cycle -&gt; de.spricom.dessert.concepts.cycle.foo:
	CycleDump -&gt; Foo</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>AssertionError</code> message is produced by the <code>DefaultCycleRenderer</code>. Another <code>CycleRenderer</code>
can be given with the <code>SliceAssert</code> method <code>renderCycleWith</code>.</p>
</div>
<div class="paragraph">
<p>The <code>partitionByPackage</code> is a specialized <code>Slice</code> method that partitions the classes of a Slice
by package-name. Thus, it produces a Map for which the package-name is the key, and the value is
a slice containing all classes that belong to the package. In this case the value is a specialized
slice that gives access to the package-name and the parent-package.</p>
</div>
<div class="paragraph">
<p>The more general <code>partitionBy</code> uses a <code>SlicePartitioner</code> that maps each class to some key.
The result is a map of <code>PartitionSlice</code>. A <code>PartitionSlice</code> is a <code>ConcreteSlice</code> (set of classes),
with the key assigned. See <code>SlicePartitioners</code> for examples of pre-defined slice partitioners.
There is another <code>partitionBy</code> method with a second <code>PartitionSliceFactory</code>
parameter. This can be used to create specialized <code>PartitionSlice</code> objects like the <code>PackageSlice</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="architecture-verification"><a class="anchor" href="#architecture-verification"></a>3.7. Architecture verification</h3>
<div class="paragraph">
<p><code>SliceAssert</code> has two additional convenience methods to verify a layered architecture. Therefore,
you have to pass a list of layers to the <code>dessert</code> method. <code>isLayeredStrict</code> check whether each
layer depends only on classes within itself or classes within its immediate successor.
<code>isLayeredRelaxed</code> relaxes this from an <em>immediate successor</em> to _any successor.
The following example shows how to use this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Classpath cp = new Classpath();
List&lt;Slice&gt; layers = Arrays.asList(
        cp.packageTreeOf(SliceAssertions.class).named("assertions"),
        cp.packageTreeOf(Slice.class).minus(ClazzPredicates.DEPRECATED).named("slicing"),
        cp.packageTreeOf(ClassResolver.class).named("resolve"),
        cp.packageTreeOf(ClassFile.class).named("classfile"),
        cp.slice("..dessert.matching|util..*").named("util")
);
dessert(layers).isLayeredRelaxed();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="class-resolving"><a class="anchor" href="#class-resolving"></a>3.8. Class resolving</h3>
<div class="paragraph">
<p>The <code>Classpath</code> needs a <code>ClassResolver</code> to find the classes it operates on. By default, the
Classpath uses a resolver that operates on the path defined by the <em>java.class.path</em>
system property. You can define your own ClassResolver and add the classes directories and
jar files you want. You can even define your own <code>ClassRoot</code> with some custom strategy to
find classes. Then pass that ClassResolver to the Classpath constructor. This will <em>freeze</em>
the ClassResolver. Thus, after a ClassResolver is used by a Classpath it, it must not
be changed.</p>
</div>
</div>
<div class="sect2">
<h3 id="duplicates"><a class="anchor" href="#duplicates"></a>3.9. Duplicates</h3>
<div class="paragraph">
<p>The <code>Classpath</code> has a method <code>duplicates</code> that returns a special <code>Slice</code> of all .class files that appear
at least twice on the <code>Classpath</code>. Other as the <code>ClassLoader</code> <em>dessert</em> does not stop at the first
class that matches a certain name. It always considers all matches. Duplicates are a common cause
of problems, because the implementation is chosen more ore less randomly.</p>
</div>
<div class="paragraph">
<p>The following code fragment demonstrates this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Classpath cp = new Classpath();
ConcreteSlice duplicates = cp.duplicates();
duplicates.getClazzes().forEach(clazz -&gt; System.out.println(clazz.getURI()));
Assertions.assertThat(duplicates.getClazzes()).isNotEmpty();

Slice slice = duplicates.minus(cp.asClazz("module-info").getAlternatives());
Assertions.assertThat(slice.getClazzes()).isEmpty();

Slice slice2 = duplicates.minus(cp.slice("module-info"));
Assertions.assertThat(slice2.getClazzes()).isEmpty();

Slice slice3 = duplicates.minus("module-info");
Assertions.assertThat(slice3.getClazzes()).isEmpty();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample uses JUnit 5 which has a <em>module-info.class</em> in each of its jars, thus <code>duplicates</code> is
not empty. The <code>Classpath</code> method <code>asClazz</code> returns a single <code>Clazz</code> object which represents one
if these module-info classes. A <code>Clazz</code> object always represents one single .class file.
<code>getAlternatives()</code> returns all classes with the name on the <code>Classpath</code>. After subtracting the
module-info classes there are no more duplicates left. An alternative way to get a slice of
all module-info classes is <code>slice("module-info")</code> or simple by using the short-cut
<code>minus("module-info")</code>, because it filters by name.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="practical-guide"><a class="anchor" href="#practical-guide"></a>4. Practical Guide</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="motivation"><a class="anchor" href="#motivation"></a>4.1. Motivation</h3>
<div class="paragraph">
<p>Keeping an architecture clean pays out manifold over time, but it has no immediate business value.
For developers architecture requirements are an additional burden. If you point out an architecture
problem, you will get answers like: "I&#8217;ll do that later, first it must be working to show it
up to the customer." Actually it&#8217;s the same with tests, but tests can be written afterwards.
If you point out the same architecture issue after it&#8217;s working you get answers like:
"Well, it&#8217;s working and the customer tested it. Never change a running system."
That&#8217;s why any architecture degrades over time. To get around this, you have to
establish an architecture awareness across your team.</p>
</div>
<div class="paragraph">
<p>As I pointed out, communicating architecture requirements won&#8217;t help. Especially inexperienced
developers will focus on other things first. Tools like SonarQube won&#8217;t help much, either.
Typically, the sonar issues are the last task during a development phase. This is
adding javadoc comments, making some variables final or something like that.
But in that phase no developer will dare to resolve a package cycle, because such a
fundamental change may break the system and needs thorough re-testing.</p>
</div>
<div class="paragraph">
<p>The <em>dessert</em> library has proved to solve this problem. It&#8217;s simple and intuitive syntax
can be read by any developer. Thus, it&#8217;s an easy way to communicate an architecture
requirement. Any violation of such a requirement will break the build on your CI system,
because the corresponding <em>dessert</em> test will fail. Hence, the nose of the
responsible developer will directly be pointed to the corresponding requirement.
Now, the only thing you need, is a plausible comment that explains why it is
important to adhere to that requirement. Over time this will build up
architecture awareness across your team.</p>
</div>
</div>
<div class="sect2">
<h3 id="sample-code"><a class="anchor" href="#sample-code"></a>4.2. Sample Code</h3>
<div class="paragraph">
<p>The code fragments below are excerpts of executable unit tests. See the
<a href="https://github.com/hajo70/dessert-site/tree/main/dessert-sample/src/test/java/de/spricom/dessert/guide">dessert-site</a> project for the full source code.</p>
</div>
</div>
<div class="sect2">
<h3 id="detecting-unwanted-dependencies"><a class="anchor" href="#detecting-unwanted-dependencies"></a>4.3. Detecting unwanted dependencies</h3>
<div class="paragraph">
<p>Developers tend to use everything, simply because it&#8217;s there, and it looks promising to accomplish
some task. Thus, anything which happens to be available on the class-path can be used for any purpose
in any place. If the software is working and the customers are happy, so what is the problem?
Well, some reasons for more restrictions might be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Internal APIs are subject to change without notice. Using internal APIs
may cause trouble when a dependency is updated.</p>
</li>
<li>
<p>If you know that some library or API will be replaced by something else, or you
want to get rid of some dependency then you surely don&#8217;t want that new code
uses that library.</p>
</li>
<li>
<p>If you have a big monolith and want to break it down into smaller modules,
then you must reduce the dependencies that hinder you and prevent developers
to introduce additional obstacles.</p>
</li>
<li>
<p>You might want to enforce a clean architecture where certain packages or
classes following some naming convention have certain responsibilities.
For example your JPA persistence layer should not use JDBC directly
or your DTOs should not access the file system.</p>
</li>
<li>
<p>You want to make sure, some critical code does not use anything that
may cause security vulnerabilities.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Detecting unwanted dependencies using <em>dessert</em> is as simple as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">assertThatSlice(something).doesNotUse(unwanted1, unwanted2);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Every developer should be able to read and understand this.
Because it&#8217;s within a unit-test it is checked during each CI build,
and it can&#8217;t be ignored.</p>
</div>
<div class="paragraph">
<p>The <em>something</em> and the <em>unwanted</em> each are a <code>Slice</code>. In <em>dessert</em> almost
everything is a <code>Slice</code> and you have many ways to tell what&#8217;s in a
certain slice.</p>
</div>
<div class="paragraph">
<p>The starting-point for each <code>Slice</code> is the <code>Classpath</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">private static final Classpath cp = new Classpath();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>Classpath</code> is a <code>Slice</code>, too.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <em>something</em> is a part of your handwritten code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// All classes of a .jar file or of the classes directory containing ClazzResolver.class
Root something1 = cp.rootOf(ClazzResolver.class);

// A single class
Clazz something2 = cp.asClazz(ClazzResolver.class);

// All classes within a certain package
Slice something3 = cp.packageOf(ClazzResolver.class);

// All classes within a certain package or any sub-package
Slice something4 = cp.packageTreeOf(ClazzResolver.class);

// The package-tree limited to the classes from the something1 Root
Slice something5 = something1.packageTreeOf(ClazzResolver.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>unwanted</em> might be something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// All classes withing the package name 'com.sun' or any sub-package
Slice unwanted1 = cp.slice("com.sun..*");

// An arbitrary list of classes
Slice unwanted2 = cp.sliceOf(ClazzResolver.class, ClassFile.class);

// A combination of packages
Slice unwanted3 = cp.slice("java.lang.reflect|runtime..*");

// Classes from internal packages
Slice unwanted4 = cp.slice("..internal..*");

// Classes following some naming pattern
Slice unwanted5 = cp.slice("..springframework..*Impl");

// Everything form a framework but a certain class
Slice unwanted6 = cp.slice("..springframework..*").minus(cp.sliceOf(Environment.class));

// The deprecated classes from the JUnit-Jupiter API .jar
Slice unwanted7 = cp.rootOf(Test.class).slice(ClazzPredicates.DEPRECATED);

// All classes annotated with @Configuration
Slice unwanted8 = cp.slice(ClazzPredicates.matchesAnnotation(AnnotationPattern.of(Configuration.class)));

// The union of two slices
Slice unwanted9 = unwanted1.plus(unwanted4);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>something</em> and the <em>unwanted</em> examples all specify a 'Slice'. Each of them
can be use in the <code>assertThatSlice</code> or in the <code>doesNotUse</code> part of the assertion.</p>
</div>
</div>
<div class="sect2">
<h3 id="enforcing-architecture-requirements"><a class="anchor" href="#enforcing-architecture-requirements"></a>4.4. Enforcing architecture requirements</h3>
<div class="paragraph">
<p>When defining an architecture you don&#8217;t specify which dependencies your building blocks must
not use, you rather define the dependencies they do have. With <em>dessert</em> you express
this with the <code>usesOnly</code> assertion:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">assertThatSlice(block).usesOnly(dep1, dep2);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, <code>block</code>, <code>dep1</code> and <code>dep2</code> are slices. Within the <code>usesOnly</code> all dependencies
that <code>block</code> has, must be listed. Usually there are many common dependencies like Java SE
classes, logging API&#8217;s or standard libraries used everywhere in your application.
For this purpose you can define an instance variable that you can use all over your
architecture test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">private final Slice common = Slices.of(
    cp.slice("java.lang|util|io|net..*"), // java packages
    cp.sliceOf(Logger.class, LogManager.class), // logging
    cp.rootOf(StringUtils.class) // apache commons-lang
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s good practice to have instances variables for all of your main building blocks and
dependencies. Then you can have a test method for each build block, that lists all the
dependencies it is allowed to have. Some of these dependencies are other building blocks, of course.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">private static final Classpath cp = new Classpath();
private static final Root dessert = cp.rootOf(Slice.class);
private static final Slice classfile = dessert.packageTreeOf(ClassFile.class);
private static final Slice slicing = dessert.packageTreeOf(Slice.class);
private static final Slice java = cp.slice("java.lang|util|io|net..*");

@Test
void testClassfileDependencies() {
    assertThatSlice(classfile).usesOnly(java);
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>Slice</code> instances are immutable.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you have several classes for architecture tests you may want to define your main
building blocks in a separate class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class BuildingBlocks {
    public static final Classpath cp = new Classpath();
    public static final Root dessert = cp.rootOf(Slice.class);
    public static final Slice classfile = dessert.packageTreeOf(ClassFile.class);
    public static final Slice slicing = dessert.packageTreeOf(Slice.class);
    public static final Slice java = cp.slice("java.lang|util|io|net..*");

    private BuildingBlocks() {
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
All slices used for an assertion must stem from the same <code>Classpath</code> instance.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="utilize-jpms-information"><a class="anchor" href="#utilize-jpms-information"></a>4.5. Utilize JPMS information</h3>
<div class="paragraph">
<p>Libraries implemented with the Java Platform Module System (JPMS) explicitly list the
exported packages. These packages form the public API of a library. Every thing else
is internal and subject to change without notice. Hence, you want to ensure
your building blocks use only the public API. One way to achieve this, is
using the JPMS for your project. But the JPMS is a bit cumbersome especially when
it comes to testing. Therefore, it&#8217;s not that wide-spread.</p>
</div>
<div class="paragraph">
<p>With <em>dessert</em> you can profit from the JPMS even if you are not using it for your
project. You still can make sure that your building blocks use only exported packages.
To access module information you need a
<a href="https://dessertj.org/apidocs/index.html?de/spricom/dessert/modules/ModuleRegistry.html">ModuleRegistry</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">private static final Classpath cp = new Classpath();
private static final ModuleRegistry mr = new ModuleRegistry(cp);
private static final JavaModules java = new JavaModules(mr);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://dessertj.org/apidocs/index.html?de/spricom/dessert/modules/fixed/JavaModules.html">JavaModules</a>
and <a href="https://dessertj.org/apidocs/index.html?de/spricom/dessert/modules/fixed/JdkModules.html">JdkModules</a>
define constants for the modules of the <em>Java Platform, Standard Edition (Java SE)</em> and
the <em>Java Development Kit (JDK)</em> respectively. To ensure some building block uses only the exported
packages of certain Java SE modules, you simply write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">assertThatSlice(dessert)
        .usesOnly(java.base, java.logging);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any other module can be accessed by name from the <code>ModuleRegistry</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">private final ModuleSlice junit = mr.getModule("org.junit.jupiter.api");</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to make sure the internal API of a module is not used, then
use an assertion like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">assertThatSlice(cp.sliceOf(this.getClass()))
        .doesNotUse(junit.getInternals());</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Dessert&#8217;s module features are available for older Java versions, too.
This may be useful to prepare for an update to a later Java version.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="more-details-about-defining-slices"><a class="anchor" href="#more-details-about-defining-slices"></a>4.6. More details about defining slices</h3>
<div class="paragraph">
<p>The slice operations can be used to create new slices from existing ones:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operation</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Slice union = slice1.plus(slice2);</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The resulting slice contains all classes from <em>slice1</em> and all classes from <em>sice2</em>.
An alternative to get the union of slices is the <code>Slices.of</code> method.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Slice intersection = slice1.slice(slice2);</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The resulting slice contains only the classes found in both slices.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Slice difference = slice1.minus(slice2);</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The resulting slice contains the classes of <em>slice1</em> that don&#8217;t belong to <em>slice2</em>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The slice operations don&#8217;t modify the original slices.</p>
</div>
<div class="paragraph">
<p>The <code>slice</code> and the <code>minus</code> methods have variants that accept patterns or predicates:</p>
</div>
<div class="listingblock">
<div class="title">Patterns</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// All classes within org.springframework
Slice spring = cp.slice("org.springframework..*");

// All classes with name ending to 'Impl'
Slice impl = spring.slice("..*Impl");

// All classes that contain 'Service' within their name
Slice service = spring.slice("..*Service*");

// All classes in any internal package
Slice internal = spring.slice("..internal..*");

// All classes with the 3rd package named 'core', in this case
// these are all classes within org.springframework.core
Slice core = spring.slice("*.*.core..*");

// A sample for a more complex pattern
Slice complex = cp.slice("..*frame*|hiber*..schema|codec..*Impl");</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Patterns are case-sensitive.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Predicates</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// All interfaces
Slice interfaces = spring.slice(ClazzPredicates.INTERFACE);

// All deprecated classes
Slice deprecated = spring.slice(ClazzPredicates.DEPRECATED);

// All final public classes
Slice finalpublic = spring.slice(Predicates.and(ClazzPredicates.FINAL, ClazzPredicates.PUBLIC));

// All classes that implement InitializingBean directly
Slice implementsDirectly = spring.slice(ClazzPredicates.implementsInterface(InitializingBean.class.getName()));

// All classes that implement Slice or another interface that extends Slice
// or that extend such a super-class
Slice implementsRecursive = dessert.slice(ClazzPredicates.matches(Slice.class::isAssignableFrom));

// All classes that's simple name matches a regex-pattern
Slice regex = spring.slice(ClazzPredicates.matchesSimpleName(".*[Ss]ervice.*"));

// All classes located in a META-INF/versions/9 directory
Slice version = cp.slice(clazz -&gt; Integer.valueOf(9).equals(clazz.getVersion()));

// All classes throwing a NoClassDefFoundError when trying to load
Slice nodef = spring.slice(this::causesNoClassDefFoundError);

// All classes that have a SourceFileAttribute
Predicate&lt;ClassFile&gt; hasSourceFile = cf -&gt;
        !Attributes.filter(cf.getAttributes(), SourceFileAttribute.class).isEmpty();
Slice source = spring.slice(ClazzPredicates.matchesClassFile(hasSourceFile));

// Some complex predicate using Predicates' combinator logic
Predicate&lt;Clazz&gt; complexPredicate = Predicates.or(
        Predicates.and(ClazzPredicates.ABSTRACT, Predicates.not(ClazzPredicates.INNER_TYPE)),
        ClazzPredicates.ENUM
);
Slice complex = spring.slice(complexPredicate);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Dessert has been optimized for patterns. Evaluation predicates can be slow.
Thus, predicates should be always the last thing to filter with.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is the implementation used above to find classes that could not be loaded:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">private boolean causesNoClassDefFoundError(Clazz clazz) {
    try {
        clazz.getClassImpl();
        return false;
    } catch (NoClassDefFoundError er) {
        return true;
    } catch (Throwable th) {
        log.info("{} caused: {}", clazz.getName(), th);
        return false;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To debug predicates it is very useful to see, what is in a slice. Hence, a method like
this is very useful:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">private void dump(Slice slice) {
    slice.getClazzes().stream()
            .map(Clazz::getName)
            .sorted()
            .forEach(System.out::println);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some libraries use annotations to mark internal or experimental code.
For example
<a href="https://junit.org/junit5/docs/current/user-guide/">JUnit 5</a>
uses <a href="https://github.com/apiguardian-team/apiguardian">@API Guardian</a>
for that purpose. Therefore, dessert provides the
<a href="https://dessertj.org/apidocs/index.html?de/spricom/dessert/util/AnnotationPattern.html">AnnotationPattern</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// classes annotated with @Configuration
Slice config = spring.slice(ClazzPredicates.matchesAnnotation(
        AnnotationPattern.of(Configuration.class)));

// classes that have methods annotated with @Bean
Slice beans = spring.slice(ClazzPredicates.matchesAnnotation(
        AnnotationPattern.of(Bean.class)));

// classes that have methods or fields annotated with @Autowired
Slice autowired = spring.slice(ClazzPredicates.matchesAnnotation(
        AnnotationPattern.of(Autowired.class)));

// classes that have methods or fields annotated with @Autowired(required = false)
Slice autowiredOptional = spring.slice(ClazzPredicates.matchesAnnotation(
        AnnotationPattern.of(Autowired.class,
                AnnotationPattern.member("required", false))));

// classes annotated with @ConditionalOnMissingBean({JpaRepositoryFactoryBean.class, JpaRepositoryConfigExtension.class})
Slice conditional = spring.slice(ClazzPredicates.matchesAnnotation(
        AnnotationPattern.of(ConditionalOnMissingBean.class,
                member("value", JpaRepositoryFactoryBean.class, JpaRepositoryConfigExtension.class))));

// a complex annotation pattern which matches to:
//    @ComponentScan(
//            excludeFilters = {@ComponentScan.Filter(
//                    type = FilterType.CUSTOM,
//                    classes = {TypeExcludeFilter.class}
//            ), @ComponentScan.Filter(
//                    type = FilterType.CUSTOM,
//                    classes = {AutoConfigurationExcludeFilter.class}
//            )}
//    )
Slice scan = spring.slice(ClazzPredicates.matchesAnnotation(
        AnnotationPattern.of(ComponentScan.class,
                member("excludeFilters",
                        AnnotationPattern.of(ComponentScan.Filter.class,
                                member("type", FilterType.CUSTOM),
                                member("classes", TypeExcludeFilter.class)
                        ),
                        AnnotationPattern.of(ComponentScan.Filter.class)
                ))
));

// the experimental junit classes
Slice experimental = junit.slice(ClazzPredicates.matchesAnnotation(
        AnnotationPattern.of(API.class, member("status", API.Status.EXPERIMENTAL))
));</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Dessert recognizes annotations for retention policy <code>RUNTIME</code> and <code>CLASS</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="detecting-cycles"><a class="anchor" href="#detecting-cycles"></a>4.7. Detecting cycles</h3>
<div class="paragraph">
<p>The problem with a cycle is, it does not have a beginning nor does it have an end. Thus, if you
pick out any class involved in a dependency cycle you cannot use it without all other classes involved
in that cycle. This is not a concern for small cycles of closely related classes, but it&#8217;s a
nightmare if you have to change a software with big intertwined cycles.</p>
</div>
<div class="paragraph">
<p>Dessert can detect cycles between any set of slices (remember: a <code>Clazz</code> is a <code>Slice</code>, too).
Sometimes it&#8217;s hard and unnecessary to prevent class cycles, but package-cycles are a clear
indicator for design flaws. There is always a clean design without package-cycles.
Use the following code to assert that some building block <code>block</code> has no package-cycle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">assertThatSlice(block.partitionByPackage()).isCycleFree();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Typically, it&#8217;s necessary to move classes to resolve a cycle. To be backwards compatible
a deprecated place-holder must be kept in the old place. Such place-holders must be
ignored, when checking for cycles. A good example for this is JUnit 5:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">assertThatSlice(cp.slice("org.junit..*")
        .minus(ClazzPredicates.DEPRECATED)
        .partitionByPackage()).isCycleFree();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any collection of slices can be used for cycle detection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">List&lt;Slice&gt; slices = Arrays.asList(slice1, slice2, slice3);
assertThatSlices(slices).areCycleFree();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be written even shorter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">assertThatSlices(slice1, slice2, slice3).areCycleFree();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because each <code>Clazz</code> is a <code>Slice</code>, detecting class-cycles is as simple as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">assertThatSlice(slice1.getClazzes()).isCycleFree();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Even a <code>Map</code> can be used to pass the slices to check:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Map&lt;String, Slice&gt; slicesByName = Map.of(
        "slice1", slice1,
        "slice2", slice2,
        "slice3", slice3
);
assertThatSlices(slicesByName).areCycleFree();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>partitionByPackage()</code> method for a <code>Slice</code> returns a <code>Map</code> of package-names
to their corresponding package slices. Hence, all non-empty packages of a slice
can be listed like that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">spring.partitionByPackage().keySet().forEach(System.out::println);</code></pre>
</div>
</div>
<div class="paragraph">
<p>To show the number of classes in each package use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">spring.partitionByPackage()
        .forEach((k, s) -&gt; System.out.printf("%s[%d]%n", k, s.getClazzes().size()));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any function that maps a <code>Clazz</code> to a string can be used to partition the
classes of a slice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">SortedMap&lt;String, PartitionSlice&gt; topLevelPackages = spring.partitionBy(this::topLevelPackageName);
assertThatSlices(topLevelPackages).areCycleFree();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The implementation below return the top-level package name for spring-framework
classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">private String topLevelPackageName(Clazz clazz) {
    Pattern pattern = Pattern.compile("org\\.springframework\\.([^.]+)\\.");
    Matcher matcher = pattern.matcher(clazz.getName());
    if (matcher.lookingAt()) {
        return matcher.group(1);
    }
    return clazz.getPackageName(); // fall-back, should not happen
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Dessert</em> comes with some pre-defined slice-partitioners. One of them is
<code>SlicePartitioners.HOST</code>. The host is the class that hosts all nested classes.
For a host or a class without nested classes the host is the class itself.
Thus, this partitioner produces slices where each slice contains a class
together with all its inner-classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">assertThatSlice(block.partitionBy(SlicePartitioners.HOST)).isCycleFree();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="keeping-vertical-slices-apart"><a class="anchor" href="#keeping-vertical-slices-apart"></a>4.8. Keeping vertical slices apart</h3>
<div class="paragraph">
<p>Big applications, sometimes called <em>monolith</em>, are used by different stakeholders for
very different use-cases. Image some stamp-shop where a customer can buy stamps. The shop-owner
must be able to add new offerings and update prices. An office clerk handles the orders
and sends the stamps to customer. Once a month the shop-owner needs to get some statistics.
Hence, an application consists of verify different and hopefully independent parts
(typically there is no 1:1 mapping between use-case and part, that&#8217;s why I name it part).
Normally the parts share components, the business model, services and other things,
and they are tied together within a common shell that provides authentication and
access control. Thus, the architecture of the application looks something like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/vertical-slices.svg" alt="vertical slices" width="305" height="202">
</div>
</div>
<div class="paragraph">
<p>In a clean design each part has its own module with explicit dependencies
to prevent any unintended cross-connections. But, this brings some overhead,
especially if there are many small parts. An alternative approach is to
use <em>dessert</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Root stampShop = cp.rootOf(ShopApplication.class);
Slice parts = stampShop.slice("..stampshop.parts..*"); // the parent package of all parts
Map&lt;String, ? extends Slice&gt; partsByName = parts.partitionBy(clazz -&gt;
        clazz.getPackageName().split("\\.", 6)[5]); // partition by sub-package name
partsByName.forEach((nameA, partA) -&gt; partsByName.forEach((nameB, partB) -&gt; {
    if (!(nameA.equals(nameB))) {
        assertThatSlice(partA).doesNotUse(partB);
    }
}));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The doubly nested loop can be replaced by using <em>dessert&#8217;s</em> <code>CombinationUtils</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">CombinationUtils.combinations(new ArrayList&lt;&gt;(partsByName.values()))
        .forEach(pair -&gt; assertThatSlice(pair.getLeft()).doesNotUse(pair.getRight()));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="checking-a-layered-architecture"><a class="anchor" href="#checking-a-layered-architecture"></a>4.9. Checking a layered architecture</h3>
<div class="paragraph">
<p>The stamp-shop above is also an example for a layered architecture with 3 layers:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/layers.svg" alt="layers" width="144" height="202">
</div>
</div>
<div class="paragraph">
<p><em>Dessert</em> provides convenience methods to check layers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Root stampShop = cp.rootOf(ShopApplication.class);
Slice application = stampShop.slice("..stampshop.application..*");
Slice parts = stampShop.slice("..stampshop.parts..*");
Slice commons = stampShop.slice("..stampshop.commons..*");

assertThatSlices(application, parts, commons).areLayeredStrict();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The test above will fail if <em>application</em> uses <em>commons</em>. To relax this use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">assertThatSlices(application, parts, common).areLayeredRelaxed();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="detecting-duplicates"><a class="anchor" href="#detecting-duplicates"></a>4.10. Detecting duplicates</h3>
<div class="paragraph">
<p>Each JAR has its own directory structure, thus a class with the same fully qualified name
may appear in more than one JAR. The <code>ClassLoader</code> always uses the first matching class
on the classpath, but the order of the JARs on the classpath may vary on different systems.
Hence, your application may use the implementation of class A from jar X on one system
and the implementation from jar Y on other systems. If these two implementations behave
differently, then you have a problem.</p>
</div>
<div class="paragraph">
<p>To prevent duplicates in your application write a test as simple as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">assertThat(cp.duplicates().minus("module-info").getClazzes()).isEmpty();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Many JARs contain a <code>module-info</code> class in their root package. Make sure to ignore
this class when checking for duplicates.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Sometimes you cannot prevent all duplicates (i.e. if you&#8217;re using Java 8), but at least you should
have a test that informs you if there are additional duplicates.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Test
@DisplayName("Make sure there are no additional duplicates")
void ensureNoAdditonalDuplicates() {
    Slice duplicates = cp.duplicates().minus("module-info");

    List&lt;File&gt; duplicateJars = duplicates.getClazzes().stream()
            .map(this::getRootFile).distinct()
            .sorted(Comparator.comparing(File::getName))
            .collect(Collectors.toList());

    Map&lt;String, Set&lt;File&gt;&gt; duplicateJarsByClass = duplicates.getClazzes().stream()
            .collect(Collectors.groupingBy(Clazz::getName,
                    TreeMap::new,
                    Collectors.mapping(this::getRootFile, Collectors.toSet())));

    System.out.printf("There are %d duplicate classes spread over %d jars:%n",
            duplicateJarsByClass.size(), duplicateJars.size());
    System.out.println("\nDuplicate classes:");
    duplicateJarsByClass.forEach((name, files) -&gt; System.out.printf("%s (%s)%n", name,
            files.stream().map(File::getName).sorted().collect(Collectors.joining(", "))));
    System.out.println("\nJARs containing duplicates:");
    duplicateJars.forEach(jar -&gt; System.out.printf("%s%n", jar.getAbsolutePath()));

    // make sure there are no additional jars involved
    assertThat(duplicateJars.stream().map(File::getName))
            .areAtLeast(3, matching(startsWith("jakarta.")))
            .hasSize(5);

    // make sure there are no additonal classes involved
    assertThat(duplicates
            .minus("javax.activation|annotation|transaction|xml..*")
            .minus("com.sun.activation..*")
            .getClazzes()).isEmpty();
}

private File getRootFile(Clazz clazz) {
    return clazz.getRoot().getRootFile();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample above prints all duplicate classes and the corresponding jars.</p>
</div>
<div class="paragraph">
<p>You may want to do some further investigations. To list all classes for which there are
binary differences in the .class file, you can use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Test
@DisplayName("Dump all duplicates for which the .class files are different")
void dumpBinaryDifferences() {
    Slice duplicates = cp.duplicates().minus("module-info");

    Map&lt;String, List&lt;Clazz&gt;&gt; duplicatesByName = duplicates.getClazzes().stream()
            .collect(Collectors.groupingBy(Clazz::getName));

    for (List&lt;Clazz&gt; list : duplicatesByName.values()) {
        list.subList(1, list.size()).forEach(c -&gt; checkBinaryContent(list.get(0), c));
    }
}

private void checkBinaryContent(Clazz c1, Clazz c2) {
    if (!isSameBinaryContent(c1, c2)) {
        System.out.printf("Binaries of %s in %s and %s are different.%n",
                c1.getName(), getRootFile(c1).getPath(), getRootFile(c2).getPath());
    }
}

private boolean isSameBinaryContent(Clazz c1, Clazz c2) {
    try {
        byte[] bin1 = IOUtils.toByteArray(c1.getURI().toURL().openStream());
        byte[] bin2 = IOUtils.toByteArray(c2.getURI().toURL().openStream());
        return Arrays.equals(bin1, bin2);
    } catch (IOException ex) {
        throw new IllegalStateException("Cannot compare duplicates of " + c1.getName());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To list all classes for which there are API differences, you can use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Test
@DisplayName("Dump all duplicates for which the API differs")
void dumpApiDifferences() {
    Slice duplicates = cp.duplicates().minus("module-info");

    Map&lt;String, List&lt;Clazz&gt;&gt; duplicatesByName = duplicates.getClazzes().stream()
            .collect(Collectors.groupingBy(Clazz::getName));

    for (List&lt;Clazz&gt; list : duplicatesByName.values()) {
        list.subList(1, list.size()).forEach(c -&gt; checkAPI(list.get(0), c));
    }
}

private void checkAPI(Clazz c1, Clazz c2) {
    if (!isSameAPI(c1, c2)) {
        System.out.printf("API of %s in %s and %s is different.%n",
                c1.getName(), getRootFile(c1).getPath(), getRootFile(c2).getPath());
    }
}

private boolean isSameAPI(Clazz c1, Clazz c2) {
    ClassFile cf1 = c1.getClassFile();
    ClassFile cf2 = c2.getClassFile();
    return cf1.getAccessFlags() == cf2.getAccessFlags()
            &amp;&amp; cf1.getThisClass().equals(cf2.getThisClass())
            &amp;&amp; cf1.getSuperClass().equals(cf2.getSuperClass())
            &amp;&amp; Arrays.equals(cf1.getInterfaces(), cf2.getInterfaces())
            &amp;&amp; isEqual(cf1.getFields(), cf2.getFields(), this::isEqual)
            &amp;&amp; isEqual(cf1.getMethods(), cf2.getMethods(), this::isEqual);
}

private &lt;T&gt; boolean isEqual(T[] t1, T[] t2, BiPredicate&lt;T, T&gt; predicate) {
    if (t1 == null &amp;&amp; t2 == null) {
        return true;
    }
    if (t1 == null || t2 == null) {
        return false;
    }
    if (t1.length != t2.length) {
        return false;
    }
    for (int i = 0; i &lt; t1.length; i++) {
        if (!predicate.test(t1[i], t2[i])) {
            return false;
        }
    }
    return true;
}

private boolean isEqual(MethodInfo m1, MethodInfo m2) {
    return m1.getAccessFlags() == m2.getAccessFlags()
            &amp;&amp; m1.getDeclaration().equals(m2.getDeclaration());
}

private boolean isEqual(FieldInfo f1, FieldInfo f2) {
    return f1.getAccessFlags() == f2.getAccessFlags()
            &amp;&amp; f1.getDeclaration().equals(f2.getDeclaration());
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="simulating-refactorings"><a class="anchor" href="#simulating-refactorings"></a>4.11. Simulating refactorings</h3>
<div class="paragraph">
<p>Sometimes a package cycle can be resolved by moving a class from one package to another.
Doing that may require many changes and&#8201;&#8212;&#8201;as a side effect&#8201;&#8212;&#8201;new cycles may be introduced.
Wouldn&#8217;t it be nice if one could predict the effects of moving a class?</p>
</div>
<div class="paragraph">
<p>With <em>dessert</em> you can use the <code>Slice</code> methods <code>minus</code> and <code>plus</code> to simulate
the removal of a <code>Clazz</code> from one slice and the addition to another:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Root stampshop = cp.rootOf(ShopApplication.class);

// Make sure original packages are cycle-free.
SortedMap&lt;String, Slice&gt; packages = new TreeMap&lt;&gt;(stampshop.partitionByPackage()); <i class="conum" data-value="1"></i><b>(1)</b>
assertThatSlices(packages).areCycleFree();

// Simulate moving class SomeUtil to package of the ShopApplication class.
Clazz classToMove = cp.asClazz(SomeUtil.class);
packages.compute(classToMove.getPackageName(),
        (packageName, slice) -&gt; slice.minus(classToMove).named(packageName)); <i class="conum" data-value="2"></i><b>(2)</b>
packages.compute(ShopApplication.class.getPackageName(),
        (packageName, slice) -&gt; slice.plus(classToMove).named(packageName));

// Check for package cycles after moving the class.
assertThatSlices(packages).areCycleFree(); <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample shows: If one moved <code>SomeUtil</code> from <code>..stampshop.parts.part3</code> to
<code>..stampshop.application</code> that would introduce a package cycle.</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create new Map&lt;String, Slice&gt; from Map&lt;String, PackageSlice&gt; to be able to replace a <code>PackageSlice</code>
by a <code>Slice</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Assign the package-name to the newly create <code>Slice</code> so that it looks like a <code>PackageSlice</code>
in the <code>AssertionError</code> message.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This assertion will fail, because a package-cycle would be introduced by moving <code>SomeUtil</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="defining-a-custom-classpath"><a class="anchor" href="#defining-a-custom-classpath"></a>4.12. Defining a custom classpath</h3>
<div class="paragraph">
<p>By default, the <code>Classpath</code> is based on the path defined by the <em>java.class.path</em> system property.
For most use-cases that&#8217;s what you want, but there might be circumstances where this is not suitable.
<code>Classpath</code> uses a <code>ClassResolver</code> to determine the locations it looks for classes.
<code>ClassResolver</code> has static factory methods for most common use cases, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Classpath customClasspath = new Classpath(ClassResolver.ofClassPathWithoutJars());</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code above defines a <code>Classpath</code> that contains only the <em>classes</em> directories of the current class-path.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Never use different <code>Classpath</code> instances in a <em>dessert</em> test. The result of <code>Slice</code> operations
and assertions is undefined if the slices originate from different <code>Classpath</code> instances and the
behaviour may change over time.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A  <code>Classpath</code>, that does not contain all classes used for an application, has some restrictions.
For example, assertions using name patterns do work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">assertThatSlice(customClasspath).doesNotUse(customClasspath.slice("org.junit.jupiter..*"));</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>Classpath</code> implements the <code>Slice</code> interfaces, thus <code>assertThatSlice</code> can be called
with <code>customClasspath</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>But assertions, that need access to the .class file, will fail:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">assertThatSlice(customClasspath).doesNotUse(customClasspath.rootOf(Test.class));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code above will throw:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>java.lang.IllegalArgumentException: org.junit.jupiter.api.Test not found within this classpath.</pre>
</div>
</div>
<div class="paragraph">
<p>To see all locations, where classes are searched for, you might use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">customClasspath.getClazzes().stream()
        .map(Clazz::getRoot)
        .map(Root::getURI)
        .distinct()
        .forEach(System.out::println);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code above is very slow, because it iterates over all classes, rather use
<code>ClassResolver.getPath()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">private void dumpRoots(ClassResolver resolver) {
    resolver.getPath().stream()
            .map(ClassRoot::getURI)
            .forEach(System.out::println);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To see all locations used by default you can use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">dumpRoots(ClassResolver.ofClassPathAndJavaRuntime());</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code above lists all locations where a <code>Classpath</code> instance, created with the default-constructor,
searches for classes.</p>
</div>
<div class="paragraph">
<p>You may even use the default <code>Classpath</code> to determine the location of .jar files, so that you
can build a custom <code>Classpath</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Classpath cp = new Classpath();
File jupiterApiJar = cp.asClazz(Test.class).getRoot().getRootFile();
File jupiterEngine = cp.asClazz(JupiterTestEngine.class).getRoot().getRootFile();
File junitPlatformEngine = cp.asClazz(TestEngine.class).getRoot().getRootFile();

ClassResolver resolver = new ClassResolver();
resolver.add(junitPlatformEngine);
resolver.add(jupiterEngine);
resolver.add(jupiterApiJar);
Classpath customClasspath = new Classpath(resolver);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="design-goals-and-features"><a class="anchor" href="#design-goals-and-features"></a>5. Design Goals and Features</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you&#8217;re considering to use <em>dessert</em> you probably have problems with dependencies.
Hence the most important design goal was to not introduce any additional dependency
that might cause you a headache.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>No other dependencies but pure java (no 3rd party libraries required)</p>
</li>
<li>
<p>Support a wide range of java versions and execution environments</p>
</li>
<li>
<p>Easy and seamless integration with other testing or assertion frameworks</p>
</li>
<li>
<p>Simple and intuitive API (motivated by <a href="https://joel-costigliola.github.io/assertj/">AssertJ</a>)</p>
</li>
<li>
<p>Assertions should be robust against refactorings (no strings for class- or package names required)</p>
</li>
<li>
<p>Compatibility to the <a href="https://docs.oracle.com/en/java/javase/17/docs/specs/man/jdeps.html">jdeps</a> utility.</p>
</li>
<li>
<p>Focus on dependency assertions and nothing else</p>
</li>
<li>
<p>Support for projects of any scale</p>
</li>
<li>
<p>Speed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The design goals lead to these features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Supports any JDK from Java 6 to Java 19</p>
</li>
<li>
<p>Has only dependencies to classes within the <code>java.base</code> module</p>
</li>
<li>
<p>Annalyzes more than 10000 classes per second on a typical developer machine
<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</li>
<li>
<p>Detects any dependency <em>jdeps</em> detects.
<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup> (This is not true the other way round,
see the FAQ why this is so.)</p>
</li>
<li>
<p>Performs the dependency analysis as late as possible to prevent any unnecessary analysis.
Thus its safe to use on big projects with lots of dependencies.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-involved"><a class="anchor" href="#getting-involved"></a>6. Getting Involved</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you&#8217;re missing some feature or find a bug then please
<a href="https://github.com/hajo70/dessert-core/issues/new">open an issue</a> on GibHub.</p>
</div>
<div class="paragraph">
<p>If you have questions the best way to get in contact is
<a href="https://github.com/hajo70/dessert-core/discussions">discussions</a>.</p>
</div>
<div class="paragraph">
<p>If you just want to send (positive) feedback, then send an e-mail to <a href="mailto:dessert@spricom.de">dessert@spricom.de</a>,
but don&#8217;t expect to get an answer, because I&#8217;m doing all this in my spare time.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="frequently-asked-questsions"><a class="anchor" href="#frequently-asked-questsions"></a>7. Frequently asked Questsions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="when-will-be-there-a-1-0-version"><a class="anchor" href="#when-will-be-there-a-1-0-version"></a>7.1. When will be there a 1.0 version?</h3>
<div class="paragraph">
<p>As along as I don&#8217;t have any feedback of someone who is using this library, there is no reason to keep the
API backwards compatible. Within the 0.x.y versions the API is subject to change without notice.
If you are using <em>dessert</em> and if you&#8217;re fine with the API then send an e-mail to <a href="mailto:dessert@spricom.de">dessert@spricom.de</a>.
As soon as there are enough e-mails I&#8217;ll release a 1.0.0 and try to keep the API backwards compatible
from that moment on.</p>
</div>
</div>
<div class="sect2">
<h3 id="why-does-dessert-find-more-dependencies-than-jdeps"><a class="anchor" href="#why-does-dessert-find-more-dependencies-than-jdeps"></a>7.2. Why does dessert find more dependencies than <em>jdeps</em>?</h3>
<div class="paragraph">
<p>Well, <em>jdeps</em> shows all runtime dependencies whereas dessert shows all compile-time
dependencies. Hence, if you use a class for which a runtime dependency is missing
you&#8217;ll get a <code>NoClassDefFoundError</code>. There are dependencies within generics or
within annotations that were required during compilation but not while using the
compiled class. For more information
see <a href="https://bugs.openjdk.java.net/browse/JDK-8134625">JDK-8134625</a>.
If you want to split a project into modules, then all the compile-time
dependencies are relevant. Thus, that&#8217;s what dessert operates on.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The compiler may have removed some source dependency that
cannot be detected in the .class file anymore.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="plans-for-dessert-core-0-6-x"><a class="anchor" href="#plans-for-dessert-core-0-6-x"></a>8. Plans for dessert-core 0.6.x</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Removal of all deprecated classes and methods</p>
</li>
<li>
<p>Virtual Clazzes (a view on specific methods or fields of a Clazz)</p>
</li>
<li>
<p>Double-scan of Jar-Files to reduce open file-handles, memory-consumption and startup-time</p>
</li>
<li>
<p>Slice-Methods plus und minus for Java-Classes.</p>
</li>
<li>
<p>Performance improvements by optimized pattern-matching and more lazy evaluation</p>
</li>
<li>
<p>Considering related classes when processing predicates to be able to recognize:</p>
<div class="ulist">
<ul>
<li>
<p>Any ancestor of the super classes or an implemented interface</p>
</li>
<li>
<p>Inherited annotations</p>
</li>
<li>
<p>Meta-annotations</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="release-notes"><a class="anchor" href="#release-notes"></a>9. Release Notes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="dessert-core-0-5-6"><a class="anchor" href="#dessert-core-0-5-6"></a>9.1. dessert-core-0.5.6</h3>
<div class="ulist">
<div class="title">Minor additions:</div>
<ul>
<li>
<p>Documentation points to Java 19.</p>
</li>
<li>
<p>Tests updated to run with Java 19.</p>
</li>
<li>
<p>Minor changes in documentation</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Bugfix:</div>
<ul>
<li>
<p>Adding path to ClassResolver does not throw NPE when threre are
JDK-Modules on the class-path.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="dessert-core-0-5-5"><a class="anchor" href="#dessert-core-0-5-5"></a>9.2. dessert-core-0.5.5</h3>
<div class="paragraph">
<p>Bugfix-release:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Does not recurse into subpackages of xx.yy when resolving name patterns like '..xx.yy.*'.</p>
</li>
<li>
<p>Performance for slice.slice(pattern).slice(pattern) has been improved.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="dessert-core-0-5-4"><a class="anchor" href="#dessert-core-0-5-4"></a>9.3. dessert-core-0.5.4</h3>
<div class="paragraph">
<p>Performance improvement:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Does not resolve all classes of a deferred slice to check whether one
class belongs to the slice. This brings a huge performance boost for
library slices given by name-patterns that comprise many classes.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="dessert-core-0-5-3"><a class="anchor" href="#dessert-core-0-5-3"></a>9.4. dessert-core-0.5.3</h3>
<div class="paragraph">
<p>Bugfix-release:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Return same URI as ClassLoader for JDK classes by removing modules prefix.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="dessert-core-0-5-2"><a class="anchor" href="#dessert-core-0-5-2"></a>9.5. dessert-core-0.5.2</h3>
<div class="paragraph">
<p>Minor additions and bugfixes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Assertions method aliases added for using plural in assertions.</p>
</li>
<li>
<p>Alias <code>assertThatSlice</code> added for <code>dessert</code>.</p>
</li>
<li>
<p>Bugfix: <code>isLayeredStrict</code> does not skip first slice anymore.</p>
</li>
<li>
<p>Bugfix: Doesn&#8217;t log warning for versioned duplicates in multi-release jars.</p>
</li>
<li>
<p>Bugfix: Encoded URL&#8217;s in within Manifest Class-Path entries will be resolved correctly.</p>
</li>
<li>
<p>Javadocs added and typos fixed.</p>
</li>
<li>
<p>Documentation: Tutorial replaced by practical guide.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="dessert-core-0-5-1"><a class="anchor" href="#dessert-core-0-5-1"></a>9.6. dessert-core-0.5.1</h3>
<div class="paragraph">
<p>Bugfixes and minor enhancements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JPMS detection fixed for Java 8</p>
</li>
<li>
<p>Adds ClazzPredicates.DEPRECATED</p>
</li>
<li>
<p>Static constructor methods os ClassResolver throw ResolveException instead of an IOException</p>
</li>
<li>
<p>Javadocs added and typos fixed</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="dessert-core-0-5-0"><a class="anchor" href="#dessert-core-0-5-0"></a>9.7. dessert-core-0.5.0</h3>
<div class="paragraph">
<p>This feature release primarily adds support for the JPMS, even for JDK 8 and older:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Utilize information within module-info classes, to make sure only exported classes are used.</p>
</li>
<li>
<p>Ready-to-use module definitions for the JDK that resemble the Java17 modules,
to be used for older java versions</p>
</li>
<li>
<p>Supports .class files up to Java 18 (inkl. sealed classes and records)</p>
</li>
<li>
<p>Support multi-release jars</p>
</li>
<li>
<p>Predicates for filtering by Annotations (for retention types class and runtime)</p>
</li>
<li>
<p>API for nested classes</p>
</li>
<li>
<p>Some utilities for combinations and dependency-closure</p>
</li>
<li>
<p>Deprecated <code>Classpath</code> method <code>sliceOf(String&#8230;&#8203;)</code> has been removed</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="dessert-core-0-4-3"><a class="anchor" href="#dessert-core-0-4-3"></a>9.8. dessert-core-0.4.3</h3>
<div class="paragraph">
<p>Preparation for 0.5.0:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/hajo70/dessert-core/issues/4">Issue #4</a>: Adds entries from Class-Path header of Manifest files</p>
</li>
<li>
<p>Improved <code>DefaultCycleRenderer</code> lists classes involved in cycle</p>
</li>
<li>
<p><code>SliceAssert</code> alias method <code>doesNotUse</code> for <code>usesNot</code> added</p>
</li>
<li>
<p><code>Classpath</code> method <code>sliceOf(String&#8230;&#8203;)</code> deprecated (to be removed in 0.5.0)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="dessert-core-0-4-2"><a class="anchor" href="#dessert-core-0-4-2"></a>9.9. dessert-core-0.4.2</h3>
<div class="paragraph">
<p>Bugfix-release:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The cycle detection algorithm ignores dependencies within the same slice, now.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="dessert-core-0-4-1"><a class="anchor" href="#dessert-core-0-4-1"></a>9.10. dessert-core-0.4.1</h3>
<div class="paragraph">
<p>Some minor changes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Duplicate .class files in JAR files won&#8217;t cause an AssertionError.</p>
</li>
<li>
<p>A <code>Clazz</code> created by <code>Classpath.asClazz(java.lang.Class&lt;?&gt;)</code> immediately contains all
alternatives on the <code>Classpath</code>.</p>
</li>
<li>
<p><code>ClassPackage</code> internally uses <code>TreeMap</code> instead of <code>List</code> to lookup classes. This
improves the performance if a package has many classes.</p>
</li>
<li>
<p>Many Javadoc additions.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="dessert-core-0-4-0"><a class="anchor" href="#dessert-core-0-4-0"></a>9.11. dessert-core-0.4.0</h3>
<div class="paragraph">
<p>Starting with this release dessert will be available on Maven Central. Therefore, the maven coordinates
have been changed. The project has been renamed to dessert-core and everything that does not belong
to the core functionality (i.e. DuplicateFinder) has been deleted.</p>
</div>
<div class="paragraph">
<p>The most prominent changes are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>New maven coordinates: de.spricom.dessert:dessert-core</p>
</li>
<li>
<p>Removal of DuplicateFinder and corresponding traversal API</p>
</li>
<li>
<p>Support for any Classfile-Format up to Java 15</p>
</li>
<li>
<p>Multi-Release JARs don&#8217;t cause an error (but version specific classes are ignored)</p>
</li>
<li>
<p>API much simpler and more intuitive: SliceEntry renamed to Clazz,
SliceContext renamed to Classpath and both implement Slice</p>
</li>
<li>
<p>The Grouping-API has been replaced by simple maps and methods for partitioning</p>
</li>
<li>
<p>Performant pattern-matching for class-names</p>
</li>
<li>
<p>Many bugfixes, simplifications and preformance-improvements</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="older-releases"><a class="anchor" href="#older-releases"></a>9.12. Older Releases</h3>
<div class="paragraph">
<p>See <a href="https://github.com/hajo70/dessert-core/releases">GitHub releases</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="copyright-and-license"><a class="anchor" href="#copyright-and-license"></a>10. Copyright and License</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Code and documentation copyright 2017–2021 <a href="https://github.com/hajo70">Hans Jörg Heßmann</a>.
Code released under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License 2.0</a>.</p>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. See the <a href="https://github.com/hajo70/dessert-tests/blob/master/dessert-jdeps-tests/src/test/java/de/spricom/dessert/classfile/DessertPerformanceTest.java">dessert-tests</a> project for a corresponding performanc test.
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. This has been verified for more that 40000 classes. See <a href="https://github.com/hajo70/dessert-tests">dessert-tests</a> for details. Please   <a href="https://github.com/hajo70/dessert-core/issues/new">open an issue</a>   if you encounter any class for which this is not true.
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-03-18 10:28:27 UTC
</div>
</div>
</body>
</html>